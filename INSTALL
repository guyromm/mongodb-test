sudo apt-get update

#base packages
sudo apt-get install emacs23-nox git-core screen python-setuptools
#dev packages
sudo apt-get install python-dev gcc libevent-dev

#git clone
git clone git@github.com:guyromm/mongodb-test.git
git config --global user.name "Guy Romm"
git config --global user.email guyromm@gmail.com

#fetch sources
root@mongo1:~/mongodb-test# git submodule update --recursive --init

#python libs
easy_install gevent gevent-websocket websocket WebOb redis routes mako pymongo


#mongodb
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv 7F0CEB10
echo 'deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen' >> /etc/apt/sources.list

apt-get update
apt-get install mongodb-10gen

#mongodb sharding config servers 
sudo mkdir /var/lib/mongocfg
mongod --configsvr --config /root/mongodb-test/mongodb-cfg.conf

#our shards internal ips:
#mongo1: 10.181.238.238
#mongo2: 10.181.239.133
#mongo3: 10.181.236.72

#mongos coordinator listens on 10000
mongos --port 10000 --configdb 10.181.239.133:9999

mongo 10.181.239.133:10000/admin
> db.runCommand({addshard:"10.181.238.238:27017",name:"mongo1"});
> db.runCommand({addshard:"10.181.239.133:27017",name:"mongo2"});
> db.runCommand({addshard:"10.181.236.72:27017",name:"mongo3"});
> db.runCommand({enablesharding:"test_database"});
> db.runCommand({shardcollection:"test_database.test_collection",key:{indexed_id:1}}); #,unique:true});

#clean launch sequence:
rm -rf /var/lib/mongocfg /var/lib/mongodb ; mkdir /var/lib/mongocfg /var/lib/mongodb ; cd mongodb-test ; git pull ; screen -c mongodb-test.screen